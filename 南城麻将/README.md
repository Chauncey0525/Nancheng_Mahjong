# 南城麻将算分小程序

一个基于微信小程序开发的南城麻将算分工具，支持胡分、杠分、码分的自动计算，采用买码规则计算每个方位的正负得分。

## 功能特点

### 核心功能
- ✅ **买码规则计算**：自动计算每个方位（东南西北）与其他三家的正负得分
- ✅ **胡分计算**：支持所有胡牌类型，包括平胡、打烂、七星、碰碰胡、七对、清一色等
- ✅ **杠分计算**：支持点杠和暗杠，自动考虑庄家翻倍
- ✅ **一炮多响**：支持多个玩家同时胡牌的情况
- ✅ **历史记录**：自动保存每局记录，支持查看详情和统计总得分

### 胡牌类型支持
| 胡牌类型 | 分数 | 说明 |
|---------|------|------|
| 平胡 | 1分 | |
| 打烂 | 2分 | |
| 七星 | 4分 | |
| 碰碰胡 | 5分 | |
| 七对 | 6分 | |
| 清一色 | 7分 | |
| 清一色碰碰胡/七对 | 10分 | |
| 天胡 | 20分 | 一家给 |
| 地胡 | 20分 | 庄家给胡牌者 |

### 特殊规则
- **庄家翻倍**：庄家输赢都翻倍
- **自摸**：三家给
- **点炮**：放炮方给
- **一炮多响**：支持一炮双响/三响

## 算分规则

### 买码规则（核心算法）

每个方位（东南西北）计算与其他三家的正负得分：

**计算公式**：`(胡分 + 杠分) × (1 + 对方的码数)`

**倍数规则**：
- 基础倍数为1
- 每有1只码是多一倍
- 比如有1只码，则分数是×2，有2只码分数×3...以此类推
- 公式：倍数 = 1 + 码数

**示例**：
- 东方需要支付南方2分胡分，获得他1分码分，并且南方有4个码
- 对于东方来说，和南方的分数关系为：`(-2 + 1) × (1 + 4) = -5分`
- 同理可算出东方与西方、北方的分数关系
- 假设对西方为：+6分，对北方为：+3分
- 则东方玩家这把的分数为：`-5 + 6 + 3 = +4分`
- 最终得分 = (对所有其他玩家的得分之和) × (1 + 自己的码数)

### 杠分规则

**点杠（明杠）**：
- 点杠者：2分
- 庄家：翻倍（4分）
- 其余玩家：1分

**暗杠**：
- 其余三家：各2分
- 庄家：翻倍（4分）

## 项目结构

```
南城麻将/
├── app.json              # 小程序配置
├── app.js                # 小程序入口
├── app.wxss              # 全局样式
├── pages/
│   ├── index/            # 算分主页面
│   │   ├── index.js
│   │   ├── index.wxml
│   │   └── index.wxss
│   └── history/          # 历史记录页面
│       ├── history.js
│       ├── history.wxml
│       └── history.wxss
├── utils/
│   ├── scoring.js        # 算分核心逻辑
│   └── config.js         # 算分规则配置
└── README.md             # 项目说明文档
```

## 使用方法

### 1. 设置玩家信息
- 输入四个方位（东南西北）的玩家名称
- 输入每个玩家的码数
- 选择庄家（只能选择一个）

### 2. 输入胡牌信息
- 选择胡牌者
- 选择胡牌类型
- 选择胡牌方式（自摸/点炮）
- 如果点炮，选择点炮者
- 如果一炮多响，可多选胡牌者

### 3. 输入杠分信息
- 点击"添加杠"按钮
- 选择杠的类型（点杠/暗杠）
- 选择杠的玩家
- 如果是点杠，选择点杠者

### 4. 计算得分
- 点击"计算得分"按钮
- 系统自动计算每个玩家的得分
- 显示详细的得分明细

### 5. 保存记录
- 计算完成后，点击"保存记录"按钮
- 记录会自动保存到本地存储
- 可在"历史"页面查看所有记录

## 技术实现

### 核心技术
- **框架**：微信小程序原生框架
- **存储**：本地存储（wx.setStorageSync）
- **算法**：买码规则计算算法

### 核心算法

买码规则计算流程：
1. 计算每个玩家的胡分（考虑庄家翻倍、自摸/点炮）
2. 计算每个玩家的杠分（考虑点杠/暗杠、庄家翻倍）
3. 对每个玩家，计算与其他三家的得分关系
4. 应用买码规则：`(胡分+杠分) × 对方码数`
5. 汇总得到每个玩家的总得分

## 开发说明

### 环境要求
- 微信开发者工具
- Node.js（可选，用于开发工具）

### 运行项目
1. 使用微信开发者工具打开项目
2. 选择"南城麻将"目录
3. 点击"编译"按钮运行

### 配置说明
- `app.json`：小程序全局配置，包括页面路径、窗口样式、tabBar等
- `utils/config.js`：算分规则配置，可在此修改胡分、杠分规则
- `utils/scoring.js`：算分核心逻辑，实现买码规则计算

## 注意事项

1. **码数输入**：确保输入的码数为非负整数
2. **庄家选择**：每局只能选择一个庄家
3. **胡牌信息**：必须选择胡牌者和胡牌类型才能计算
4. **点炮信息**：如果选择点炮，必须选择点炮者
5. **杠分信息**：如果添加了杠，必须完整填写杠的信息
6. **历史记录**：最多保存100条记录，超出会自动删除最旧的记录

## 更新日志

### v1.0.0 (2026-01-14)
- ✅ 实现买码规则计算算法
- ✅ 支持所有胡牌类型
- ✅ 支持点杠和暗杠计算
- ✅ 支持自摸和点炮
- ✅ 支持一炮多响
- ✅ 实现历史记录功能
- ✅ 完整的移动端UI设计

## 许可证

本项目仅供学习和个人使用。

## 联系方式

如有问题或建议，欢迎提交Issue或Pull Request。
